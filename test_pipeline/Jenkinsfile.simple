pipeline {
    agent any
    
    // ç®€å•çš„å‚æ•°é…ç½®
    parameters {
        choice(
            name: 'ENVIRONMENT',
            choices: ['dev', 'test', 'staging', 'prod'],
            description: 'é€‰æ‹©éƒ¨ç½²ç¯å¢ƒ'
        )
        string(
            name: 'VERSION',
            defaultValue: '1.0.0',
            description: 'ç‰ˆæœ¬å·'
        )
        booleanParam(
            name: 'SKIP_TESTS',
            defaultValue: false,
            description: 'æ˜¯å¦è·³è¿‡æµ‹è¯•é˜¶æ®µ'
        )
    }
    
    // ç®€å•çš„ç¯å¢ƒå˜é‡
    environment {
        APP_NAME = 'jenkins-test-app'
    }
    
    stages {
        stage('å‡†å¤‡') {
            steps {
                echo "å¼€å§‹æ„å»º ${env.APP_NAME}"
                echo "ç›®æ ‡ç¯å¢ƒ: ${params.ENVIRONMENT}"
                echo "ç‰ˆæœ¬å·: ${params.VERSION}"
            }
        }
        
        stage('ä»£ç æ£€å‡º') {
            steps {
                checkout scm
                echo "ä»£ç æ£€å‡ºå®Œæˆ"
            }
        }
        
        stage('æ„å»º') {
            steps {
                echo "æ­£åœ¨æ„å»ºé¡¹ç›®..."
                sleep(2)
                echo "æ„å»ºå®Œæˆ!"
            }
        }
        
        stage('æµ‹è¯•') {
            when {
                expression { !params.SKIP_TESTS }
            }
            steps {
                echo "è¿è¡Œæµ‹è¯•..."
                sleep(3)
                echo "æµ‹è¯•å®Œæˆ!"
            }
        }
        
        stage('éƒ¨ç½²') {
            when {
                expression { params.ENVIRONMENT != 'dev' }
            }
            steps {
                script {
                    echo "éƒ¨ç½²åˆ° ${params.ENVIRONMENT} ç¯å¢ƒ..."
                    
                    if (params.ENVIRONMENT == 'prod') {
                        echo "ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²éœ€è¦é¢å¤–éªŒè¯"
                        // ç”Ÿäº§ç¯å¢ƒå¯ä»¥æ·»åŠ inputæ­¥éª¤
                    }
                    
                    echo "éƒ¨ç½²å®Œæˆ!"
                }
            }
        }
        
        stage('é€šçŸ¥') {
            steps {
                echo "ğŸ‰ Pipelineæ‰§è¡Œå®Œæˆ!"
                echo "é¡¹ç›®: ${env.APP_NAME}"
                echo "ç‰ˆæœ¬: ${params.VERSION}"
                echo "ç¯å¢ƒ: ${params.ENVIRONMENT}"
            }
        }
    }
    
    post {
        always {
            echo "Pipeline æ‰§è¡Œå®Œæˆ"
        }
        success {
            echo "âœ… æ„å»ºæˆåŠŸ!"
        }
        failure {
            echo "âŒ æ„å»ºå¤±è´¥!"
        }
    }
}
